[2025-06-25 22:39:03,954] [INFO] [default] - Logger initialized. Log file: experiments/logs/default_20250625_223903.log
[2025-06-25 22:39:03,954] [INFO] [default] - 🚀 开始重构异常检测失败原因分析...
[2025-06-25 22:39:03,954] [INFO] [default] - 📂 加载Contact数据...
[2025-06-25 22:39:04,830] [INFO] [default] - 训练数据形状: (365254, 27)
[2025-06-25 22:39:04,830] [INFO] [default] - 测试数据形状: (134700, 27)
[2025-06-25 22:39:04,831] [INFO] [default] - 异常比例: 5.16%
[2025-06-25 22:39:04,834] [INFO] [default] - 🔍 分析数据特性...
[2025-06-25 22:39:04,838] [INFO] [default] - === 数据复杂性分析 ===
[2025-06-25 22:39:04,866] [INFO] [default] - 高相关性特征对数量 (>0.9): 41
| 分析项    | 发现                              |
| ------ | ------------------------------- |
| 高相关特征对 | 41对，说明存在强共线性，可导致模型“靠一个变量猜出其他变量” |
| 低方差特征  | 0，说明无冗余静态特征                     |
| 高偏度特征  | 3 个，可能影响建模稳定性                   |

[2025-06-25 22:39:04,887] [INFO] [default] - 低方差特征数量 (<0.01): 0
[2025-06-25 22:39:04,920] [INFO] [default] - 高偏度特征数量 (|skew|>2): 3
[2025-06-25 22:39:04,920] [INFO] [default] - 
=== 可重构性分析 ===
[2025-06-25 22:39:05,566] [INFO] [default] - 正常样本平均复杂度: 9.197748
[2025-06-25 22:39:05,566] [INFO] [default] - 异常样本平均复杂度: 6.389511
解释：你希望异常点“更难重构”，但它们恰恰“更容易”被模型复现。

系统警告：可能是模型过度泛化，或异常点结构过于规整（low-complexity）。
[2025-06-25 22:39:05,566] [INFO] [default] - 复杂度比例: 0.695
[2025-06-25 22:39:05,597] [INFO] [default] - 正常样本与训练集平均相似性: -0.0205
[2025-06-25 22:39:05,597] [INFO] [default] - 异常样本与训练集平均相似性: -0.1142
[2025-06-25 22:39:05,597] [INFO] [default] - 🧪 测试简单重构基线...
[2025-06-25 22:39:05,597] [INFO] [default] - 测试线性自编码器...
[2025-06-25 22:39:07,687] [INFO] [default] -   P90阈值: F1=0.0145, P=0.0110, R=0.0213
[2025-06-25 22:39:07,692] [INFO] [default] -   P95阈值: F1=0.0025, P=0.0025, R=0.0024
[2025-06-25 22:39:07,697] [INFO] [default] -   P99阈值: F1=0.0019, P=0.0059, R=0.0012
[2025-06-25 22:39:07,701] [INFO] [default] -   P99.5阈值: F1=0.0021, P=0.0119, R=0.0012
[2025-06-25 22:39:07,702] [INFO] [default] - 测试PCA重构...
[2025-06-25 22:39:07,818] [INFO] [default] -   PCA-10: F1=0.0158, 解释方差=0.985
[2025-06-25 22:39:07,865] [INFO] [default] -   PCA-20: F1=0.0113, 解释方差=1.000
[2025-06-25 22:39:07,906] [INFO] [default] -   PCA-13: F1=0.0022, 解释方差=0.996
[2025-06-25 22:39:07,906] [INFO] [default] - 测试马哈拉诺比斯距离...
[2025-06-25 22:39:07,957] [INFO] [default] -   马哈拉诺比斯距离: F1=0.0089
[2025-06-25 22:39:07,957] [INFO] [default] - 
AE、PCA、Mahalanobis 全部失败（F1 < 0.02）；

说明：异常点和正常点在低维线性空间中无法有效分离。


=== 重构失败原因分析 ===
[2025-06-25 22:39:07,959] [INFO] [default] - 正常样本重构误差: 均值=9.464100, 标准差=8.400022
[2025-06-25 22:39:07,959] [INFO] [default] - 异常样本重构误差: 均值=6.576734, 标准差=7.426354
[2025-06-25 22:39:07,960] [INFO] [default] - 误差分离度: -0.344
✅ 结论：异常样本是“局部规整 + 分布边缘”，对线性模型并不构成挑战，因此被轻易重构。


[2025-06-25 22:39:07,960] [WARNING] [default] - ⚠️ 异常样本的重构误差与正常样本相近，模型可能过度泛化
[2025-06-25 22:39:07,964] [INFO] [default] - 🔍 分析TimesNet特定问题...
[2025-06-25 22:39:07,964] [INFO] [default] - === 时序长度分析 ===
[2025-06-25 22:39:07,965] [INFO] [default] -   seq_len=50: 窗口平均方差=1.561226
[2025-06-25 22:39:07,967] [INFO] [default] -   seq_len=100: 窗口平均方差=1.501821
[2025-06-25 22:39:07,968] [INFO] [default] -   seq_len=200: 窗口平均方差=1.366831
[2025-06-25 22:39:07,968] [INFO] [default] - 

窗口越长，时序越平滑 → 异常点的冲击被“平均掉”。

若异常是短时脉冲，长窗口不利于检测。

✅ 建议：

使用 短窗口（如 30~50）+ 滑窗推进；

或改为 多尺度窗口建模（结合 long + short）

=== 周期性分析 ===
[2025-06-25 22:39:07,975] [INFO] [default] -   特征0的主要周期: [np.float64(480.0), np.float64(720.0), np.float64(1440.0)]
[2025-06-25 22:39:07,975] [INFO] [default] -   特征1的主要周期: [np.float64(480.0), np.float64(720.0), np.float64(1440.0)]
[2025-06-25 22:39:07,975] [INFO] [default] -   特征2的主要周期: [np.float64(480.0), np.float64(720.0), np.float64(1440.0)]

TimesNet适用于此类多周期数据，周期提取有效；

问题可能不是周期建模失败，而是异常本身对周期扰动小。


[2025-06-25 22:39:07,975] [INFO] [default] - 
=== 特征重要性分析 ===
[2025-06-25 22:39:08,010] [INFO] [default] - Top 5 重要特征:
[2025-06-25 22:39:08,011] [INFO] [default] -   特征10: 方差=1.0000, 区分力=0.8012
[2025-06-25 22:39:08,011] [INFO] [default] -   特征8: 方差=1.0000, 区分力=0.7777
[2025-06-25 22:39:08,011] [INFO] [default] -   特征9: 方差=1.0000, 区分力=0.7712
[2025-06-25 22:39:08,011] [INFO] [default] -   特征22: 方差=1.0000, 区分力=0.5839
[2025-06-25 22:39:08,011] [INFO] [default] -   特征20: 方差=1.0000, 区分力=0.5766
[2025-06-25 22:39:08,011] [INFO] [default] - 

✅ 存在少量特征对异常具有强感知能力；

❗但若模型训练只依赖这几维（e.g., 通过通道注意力），将忽略全局时序结构 → 出现 overfitting shortcut。

=== 数据质量问题 ===
[2025-06-25 22:39:08,104] [INFO] [default] - 平均异常值比例: 2.92%
[2025-06-25 22:39:08,108] [INFO] [default] - 可能非平稳的特征数: 2/10
[2025-06-25 22:39:08,108] [INFO] [default] - 💡 提出解决方案...
[2025-06-25 22:39:08,108] [INFO] [default] - 建议的解决方案:
[2025-06-25 22:39:08,108] [INFO] [default] -   1. 异常样本复杂度不足，考虑重新定义异常标准
[2025-06-25 22:39:08,108] [INFO] [default] -   2. 使用动态阈值或多阈值融合策略
[2025-06-25 22:39:08,108] [INFO] [default] -   3. 考虑使用训练数据的重构误差分布来设定阈值
[2025-06-25 22:39:08,108] [INFO] [default] - 📋 生成综合分析报告...
[2025-06-25 22:39:08,108] [INFO] [default] - 📄 分析报告已保存: reconstruction_failure_analysis.md
[2025-06-25 22:39:08,108] [INFO] [default] - ✅ 分析完成！

# TimesNet重构异常检测失败原因分析报告

## 🎯 核心发现

### 数据特性问题
- 高相关性特征对: 41
- 低方差特征数: 0
- 异常样本复杂度比例: 0.695
- 异常样本相似性: -0.114

### 基线方法性能
- linear_ae_p90: F1=0.0145
- linear_ae_p95: F1=0.0025
- linear_ae_p99: F1=0.0019
- linear_ae_p99.5: F1=0.0021
- pca_10: F1=0.0158
- pca_20: F1=0.0113
- pca_13: F1=0.0022
- mahalanobis: F1=0.0089

### TimesNet特定问题
- 平均异常值比例: 2.92%
- 非平稳特征数: 2/10
- 数据质量问题: 无

## 🔍 失败原因分析

### 1. 数据本身的问题
- **高维度低区分度**: 27个特征中可能存在大量冗余信息
- **异常样本不够"异常"**: 异常样本与正常样本在特征空间中距离不够远
- **训练数据过度平滑**: 过滤异常后的训练数据可能过于"完美"

### 2. 重构任务的固有困难
- **过度泛化**: 模型学会重构所有样本，包括异常样本
- **表示能力过强**: TimesNet的表示能力可能超过了数据的复杂度
- **阈值设定困难**: 重构误差分布重叠严重

### 3. TimesNet架构不匹配
- **周期性假设**: TimesNet假设存在周期性，但Contact数据可能缺乏明显周期
- **时序依赖性**: 异常可能是瞬时的，不依赖长期时序模式

## 💡 解决方案
1. 异常样本复杂度不足，考虑重新定义异常标准
2. 使用动态阈值或多阈值融合策略
3. 考虑使用训练数据的重构误差分布来设定阈值

## 🎯 关键结论

**TimesNet在Contact数据上失败的根本原因可能是:**
1. **数据特性不匹配**: Contact数据缺乏TimesNet擅长的周期性模式
2. **异常定义问题**: 当前的异常标注可能不够明确或一致
3. **重构范式局限**: 对于这类数据，重构可能不是最佳的异常检测方式

**建议采用的替代方案:**
- 基于密度的异常检测 (如Isolation Forest)
- 基于距离的方法 (如LOF)
- 简化的神经网络架构
- 重新审视异常标注标准

重构异常检测失效的根本原因在于：异常样本呈现低复杂度、低方差的拟态行为，且可被线性模型轻易重构。同时，强相关特征结构导致模型可利用冗余信息推断各通道，造成过度泛化。此外，使用较长的时间窗口进一步稀释了异常信号，使重构误差分离度反转，无法作为有效判据。

| 问题      | 建议                                   |
| ------- | ------------------------------------ |
| 重构误差不分离 | 改为监督点分类（逐点标签）或残差序列建模                 |
| 相关性过高   | 加入通道压缩（通道 attention）或删除冗余特征          |
| 长窗口稀释异常 | 使用短滑窗（30\~60），或结合多尺度                 |
| 周期结构弱扰动 | 使用周期增强 loss，如 trend vs seasonal 误差对比 |
| 模型过度泛化  | 增加重构正则（如Dropout、混合扰动、contrastive）    |
