# Phase 2 æœ€ç»ˆç»“æœæŠ¥å‘Š

**å®Œæˆæ—¶é—´**: 2026-01-22 13:32
**æ€»è®­ç»ƒæ—¶é—´**: ~11 åˆ†é’Ÿï¼ˆæ‰€æœ‰æ¨¡å‹å¹¶è¡Œï¼‰
**çŠ¶æ€**: âœ… å…¨éƒ¨å®Œæˆ

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”æ€»è¡¨

| æ¨¡å‹ | MSE | MAE | CRPS | æ ¡å‡†50% | æ ¡å‡†90% | è®­ç»ƒEpoch | è®­ç»ƒæ—¶é—´ | å¤‡æ³¨ |
|------|-----|-----|------|---------|---------|----------|---------|------|
| **PatchTST** ğŸ† | **0.3771** | **0.3969** | N/A | N/A | N/A | 13/30 | ~2.5min | **ç‚¹é¢„æµ‹æœ€ä½³** |
| **TimesNet** ğŸ¥ˆ | 0.3891 | 0.4120 | N/A | N/A | N/A | 16/30 | ~8min | Multi-period |
| **iTransformer** ğŸ¥‰ | 0.3945 | 0.4095 | N/A | N/A | N/A | 14/30 | ~1.3min | Backbone |
| **åŸºçº¿ (ours)** | 0.7087 | 0.5415 | **0.4957** | **0.4989** | **0.8578** | 6/30 | ~3.7min | **æ¦‚ç‡é¢„æµ‹** |

---

## ğŸ” è¯¦ç»†åˆ†æ

### 1. ç‚¹é¢„æµ‹æ€§èƒ½ (MSE/MAE)

**æ’å**:
1. ğŸ¥‡ **PatchTST**: MSE 0.3771 (åŸºå‡†)
2. ğŸ¥ˆ **TimesNet**: MSE 0.3891 (+3.2% vs PatchTST)
3. ğŸ¥‰ **iTransformer**: MSE 0.3945 (+4.6% vs PatchTST)
4. âš ï¸ **åŸºçº¿**: MSE 0.7087 (+88% vs PatchTST)

**å…³é”®å‘ç°**:
- âŒ **åŸºçº¿ç‚¹é¢„æµ‹æ€§èƒ½è¿œä½äºé¢„æœŸ** (MSE 0.7087 vs ç›®æ ‡ 0.50-0.60)
- âœ… ç¡®å®šæ€§æ¨¡å‹è¡¨ç°ç¬¦åˆé¢„æœŸ
- âœ… PatchTST åœ¨ç‚¹é¢„æµ‹ä¸Šè¡¨ç°æœ€ä½³

---

### 2. æ¦‚ç‡é¢„æµ‹æ€§èƒ½ (CRPS/æ ¡å‡†åº¦)

**åŸºçº¿æ¨¡å‹ç‹¬æœ‰æŒ‡æ ‡**:
- **CRPS**: 0.4957
  - vs Phase 1: 0.469 (**+5.7%** âš ï¸ ç•¥å·®)
  - vs é¢„æœŸç›®æ ‡: 0.40-0.45 (**+23%** æœªè¾¾æ ‡)

- **æ ¡å‡†åº¦**:
  - **50%è¦†ç›–ç‡**: 0.4989 âœ… æ¥è¿‘ç†æƒ³å€¼ 0.50
  - **90%è¦†ç›–ç‡**: 0.8578 âœ… æ¥è¿‘ç†æƒ³å€¼ 0.90
  - vs Phase 1: 50%=0.415, 90%=0.779 (**æ˜¾è‘—æå‡** âœ“)

- **Sharpness**: 0.6658
  - vs Phase 1: 0.577 (+15%)

**å…³é”®å‘ç°**:
- âœ… **æ ¡å‡†åº¦å¤§å¹…æå‡** (Phase 1 çš„ä¸»è¦é—®é¢˜å·²è§£å†³)
- âŒ **CRPS åè€Œå˜å·®** (å¯èƒ½æ˜¯ early stopping å¤ªæ—©)
- âš ï¸ **ç‚¹é¢„æµ‹MSEè¿‡é«˜** (ä¸¥é‡æ‹–ç´¯æ•´ä½“æ€§èƒ½)

---

### 3. è®­ç»ƒæ•ˆç‡å¯¹æ¯”

| æ¨¡å‹ | æœ€ä½³Epoch | æ€»Epoch | Early Stop | å¹³å‡é€Ÿåº¦ | æ€»è€—æ—¶ |
|------|----------|---------|-----------|---------|--------|
| iTransformer | 9 | 14 | Epoch 14 | ~5.5s/epoch | ~1.3min |
| PatchTST | 8 | 13 | Epoch 13 | ~12s/epoch | ~2.5min |
| TimesNet | 11 | 16 | Epoch 16 | ~30s/epoch | ~8min |
| åŸºçº¿ | 1 | 6 | **Epoch 6** | ~28s/epoch | ~3.7min |

**å…³é”®å‘ç°**:
- âš ï¸ **åŸºçº¿åœ¨ Epoch 1 è¾¾åˆ°æœ€ä½³ï¼Œåç»­æ€§èƒ½ä¸‹é™**
- âš ï¸ Early stopping è¿‡æ—©è§¦å‘ï¼ˆä»…è®­ç»ƒ6ä¸ªepochï¼‰
- âš ï¸ å¯èƒ½å­˜åœ¨è®­ç»ƒé…ç½®é—®é¢˜

---

## ğŸš¨ é—®é¢˜è¯Šæ–­

### ä¸»è¦é—®é¢˜: åŸºçº¿MSEè¿‡é«˜ (0.7087 vs 0.37-0.39)

**å¯èƒ½åŸå› **:

#### 1. Early Stopping è¿‡æ—© â­â­â­
```
Epoch 1: Vali 604.08 â† æœ€ä½³
Epoch 2: Vali 646.24
Epoch 3: Vali 613.66
Epoch 4: Vali 655.64
Epoch 5: Vali 689.70
Epoch 6: Vali 627.20 â†’ Early Stop (patience=5)
```
- **é—®é¢˜**: éªŒè¯æŸå¤±åœ¨ Epoch 1 å°±è¾¾åˆ°æœ€ä½³ï¼Œåç»­æŒç»­æ³¢åŠ¨ä¸Šå‡
- **å½±å“**: æ¨¡å‹å®é™…ä¸Šåªè®­ç»ƒäº†1ä¸ªæœ‰æ•ˆepoch
- **å¯èƒ½åŸå› **: éªŒè¯æŸå¤±è®¡ç®—æ–¹å¼ä¸é€‚åˆæ‰©æ•£æ¨¡å‹ï¼ˆå«é‡‡æ ·éšæœºæ€§ï¼‰

#### 2. éªŒè¯æŸå¤±è®¡ç®—é—®é¢˜ â­â­â­
- éªŒè¯æŸå¤±æ•°å€¼å¼‚å¸¸å¤§ï¼ˆ600+ï¼‰ï¼Œä¸è®­ç»ƒæŸå¤±(~0.5)é‡çº§å®Œå…¨ä¸åŒ
- å¯èƒ½æ˜¯éªŒè¯æ—¶çš„CRPSè®¡ç®—å¯¼è‡´æ•°å€¼è¿‡å¤§
- åº”è¯¥ç”¨MSEä½œä¸ºearly stoppingæ ‡å‡†ï¼Œè€Œä¸æ˜¯æ‰©æ•£æŸå¤±

#### 3. è¯¾ç¨‹å­¦ä¹ æƒé‡è°ƒåº¦ â­â­
```
Epoch 1: Î±=1.00 (çº¯MSE)
Epoch 2: Î±=0.92
Epoch 3: Î±=0.83
Epoch 4: Î±=0.75
Epoch 5: Î±=0.67
Epoch 6: Î±=0.58
```
- ä» Epoch 2 å¼€å§‹æ‰©æ•£æŸå¤±æƒé‡é€æ¸å¢åŠ 
- Epoch 1 æ—¶ Î±=1.00ï¼ˆåªæœ‰ MSEæŸå¤±ï¼‰ï¼Œæ‰€ä»¥æ€§èƒ½æœ€å¥½
- åç»­æ‰©æ•£æŸå¤±å¢åŠ åè€ŒæŸå®³äº†ç‚¹é¢„æµ‹æ€§èƒ½

#### 4. æ¨¡å‹å®¹é‡ä¸è¶³ â­
- è™½ç„¶å¢åŠ åˆ° d_model=128, e_layers=2
- ä½†å¯èƒ½ä»ä¸è¶³ä»¥åŒæ—¶ä¼˜åŒ–MSEå’Œæ‰©æ•£æŸå¤±

---

## ğŸ’¡ Phase 2 vs Phase 1 å¯¹æ¯”

| æŒ‡æ ‡ | Phase 1 | Phase 2 | å˜åŒ– | è¯„ä»· |
|------|---------|---------|------|------|
| **MSE** | 0.736 | **0.7087** | -3.7% | âš ï¸ ä»è¿‡é«˜ |
| **CRPS** | **0.469** | 0.4957 | +5.7% | âŒ åè€Œå˜å·® |
| **æ ¡å‡†50%** | 0.415 | **0.4989** | +20% | âœ… å¤§å¹…æå‡ |
| **æ ¡å‡†90%** | 0.779 | **0.8578** | +10% | âœ… å¤§å¹…æå‡ |
| **è®­ç»ƒEpoch** | 5 | 6 | - | éƒ½å› early stopæå‰ç»“æŸ |
| **é…ç½®** | d=64,e=1 | d=128,e=2 | - | å®¹é‡å¢åŠ ä½†æœªæ”¹å–„ |

**ç»“è®º**:
- âœ… æ ¡å‡†åº¦é—®é¢˜å·²è§£å†³
- âŒ ç‚¹é¢„æµ‹å’ŒCRPSæœªæ”¹å–„
- âš ï¸ æ ¸å¿ƒé—®é¢˜ï¼šearly stopping æœºåˆ¶ä¸é€‚åˆå½“å‰è®­ç»ƒç­–ç•¥

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®

### ç´§æ€¥ä¿®å¤ (Phase 2.2) â­â­â­

#### ä¿®å¤ 1: æ›´æ”¹ Early Stopping æ ‡å‡†
**å½“å‰**: ä½¿ç”¨éªŒè¯æŸå¤±ï¼ˆåŒ…å«CRPSï¼Œæ•°å€¼å¤§ä¸”æ³¢åŠ¨ï¼‰
**å»ºè®®**: æ”¹ä¸ºä½¿ç”¨éªŒè¯é›†çš„ **MSE æŸå¤±**

**ä¿®æ”¹ä½ç½®**: `exp/exp_diffusion_forecast.py`
```python
# å½“å‰:
vali_loss = self.vali(...)  # è¿”å›åŒ…å«CRPSçš„æŸå¤±

# å»ºè®®:
vali_mse = self.vali_mse(...)  # åªè¿”å›MSE
```

#### ä¿®å¤ 2: å»¶é•¿è®­ç»ƒæˆ–è°ƒæ•´ Patience
- **å½“å‰**: patience=5ï¼ˆ6ä¸ªepochå°±åœæ­¢ï¼‰
- **å»ºè®®**: patience=10 æˆ– å®Œå…¨å–æ¶ˆ early stoppingï¼Œè®­ç»ƒå®Œæ•´30ä¸ªepoch

#### ä¿®å¤ 3: è°ƒæ•´è¯¾ç¨‹å­¦ä¹ ç­–ç•¥
**é€‰é¡¹ A**: å»¶é•¿ warmupï¼ˆä¿æŒæ›´é•¿æ—¶é—´çš„MSEä¸ºä¸»ï¼‰
```python
warmup_epochs = 15  # ä»6å¢åŠ åˆ°15
```

**é€‰é¡¹ B**: å›ºå®šæƒé‡ï¼ˆä¸ä½¿ç”¨è¯¾ç¨‹å­¦ä¹ ï¼‰
```python
alpha = 0.7  # å›ºå®š70% MSE + 30% Diff
```

**é€‰é¡¹ C**: åå‘è¯¾ç¨‹å­¦ä¹ ï¼ˆå…ˆå­¦æ‰©æ•£ï¼Œåå­¦MSEï¼‰
```python
alpha = 0.3 â†’ 0.7  # é€æ¸å¢åŠ MSEæƒé‡
```

---

### å¯¹æ¯”å®éªŒéªŒè¯ (Phase 2.3)

#### å®éªŒ 1: ç¡®å®šæ€§ Backbone å¯¹æ¯”
è®­ç»ƒçº¯MSEçš„åŸºçº¿ï¼ˆä¸åŒ…å«æ‰©æ•£ï¼‰:
```bash
python run.py --task_name long_term_forecast --model iTransformer \
  --d_model 128 --e_layers 2 --train_epochs 30
```
**ç›®çš„**: éªŒè¯backboneæœ¬èº«çš„æ€§èƒ½ä¸Šé™

#### å®éªŒ 2: ä¸åŒ Early Stopping ç­–ç•¥
- A: ç”¨MSEä½œä¸ºearly stoppingæ ‡å‡†
- B: å®Œå…¨ä¸ç”¨early stoppingï¼ˆå›ºå®š30 epochï¼‰
- C: æ›´å¤§çš„patience (patience=10)

#### å®éªŒ 3: ä¸åŒè¯¾ç¨‹å­¦ä¹ ç­–ç•¥
- A: å»¶é•¿warmup (warmup=15)
- B: å›ºå®šæƒé‡ (Î±=0.7)
- C: åå‘è¯¾ç¨‹å­¦ä¹ 

---

## ğŸ“Š FR2 ä¼˜åŒ–å†³ç­–

åŸºäºå½“å‰ç»“æœï¼Œ**æš‚ä¸å»ºè®®å®æ–½ FR2**ï¼ŒåŸå› ï¼š

1. âŒ ä¸»è¦é—®é¢˜ä¸æ˜¯é¢‘åŸŸè¡¨è¾¾èƒ½åŠ›
2. âŒ é—®é¢˜åœ¨äºè®­ç»ƒç­–ç•¥ï¼ˆearly stopping + è¯¾ç¨‹å­¦ä¹ ï¼‰
3. âœ… åº”å…ˆä¿®å¤è®­ç»ƒç­–ç•¥ï¼Œå†è€ƒè™‘æ¶æ„ä¼˜åŒ–

**FR2 å®æ–½æ¡ä»¶**:
- è®­ç»ƒç­–ç•¥ä¿®å¤åï¼ŒMSEä» > 0.50
- é¢‘åŸŸæŸå¤±æ˜æ˜¾åé«˜
- å‘¨æœŸæ€§é¢„æµ‹ä¸å‡†ç¡®

---

## ğŸ“ ç»“æœæ–‡ä»¶ä½ç½®

```
checkpoints/
â”œâ”€â”€ diffusion_forecast_ETTh1_96_96_baseline_iTransformerDiffusionDirect_*/
â”‚   â””â”€â”€ checkpoint.pth  (Epoch 1 best model)
â”œâ”€â”€ long_term_forecast_ETTh1_96_96_baseline_iTransformer_*/
â”‚   â””â”€â”€ checkpoint.pth
â”œâ”€â”€ long_term_forecast_ETTh1_96_96_baseline_PatchTST_*/
â”‚   â””â”€â”€ checkpoint.pth
â””â”€â”€ long_term_forecast_ETTh1_96_96_baseline_TimesNet_*/
    â””â”€â”€ checkpoint.pth

logs/phase2/
â”œâ”€â”€ baseline.log  - åŸºçº¿è®­ç»ƒå®Œæ•´æ—¥å¿—
â”œâ”€â”€ iTransformer.log
â”œâ”€â”€ PatchTST.log
â””â”€â”€ TimesNet.log
```

---

## âœ… Phase 2.1 å®Œæˆæƒ…å†µ

| ç›®æ ‡ | å®Œæˆåº¦ | å¤‡æ³¨ |
|------|--------|------|
| åŸºçº¿ MSE < 0.60 | âŒ 0.71 | æœªè¾¾æ ‡ |
| åŸºçº¿ CRPS < 0.45 | âŒ 0.50 | æœªè¾¾æ ‡ |
| å®Œæˆ3ä¸ªæ¨¡å‹å¯¹æ¯” | âœ… | å·²å®Œæˆ |
| è¯†åˆ«å…³é”®ç“¶é¢ˆ | âœ… | Early stopping + è¯¾ç¨‹å­¦ä¹  |
| è¾“å‡ºåˆ†ææŠ¥å‘Š | âœ… | æœ¬æ–‡æ¡£ |

---

## ğŸš€ ç«‹å³å¯æ‰§è¡Œçš„ä¿®å¤

### ä¿®å¤è„šæœ¬: Phase 2.2 - æ”¹è¿›è®­ç»ƒç­–ç•¥

åˆ›å»ºæ–°çš„è®­ç»ƒè„šæœ¬ï¼Œä¿®å¤ early stopping é—®é¢˜:

```bash
# æ–¹æ¡ˆ A: å»¶é•¿è®­ç»ƒ + æ›´å¤§ patience
python run.py \
  --model iTransformerDiffusionDirect \
  --train_epochs 50 \
  --warmup_epochs 15 \
  --patience 10 \
  ...

# æ–¹æ¡ˆ B: å›ºå®šæƒé‡ + å®Œæ•´è®­ç»ƒ
python run.py \
  --model iTransformerDiffusionDirect \
  --train_epochs 30 \
  --loss_lambda 0.7 \  # å›ºå®š70% MSE
  --no_early_stop \     # æ–°å‚æ•°ï¼Œç¦ç”¨early stopping
  ...
```

---

**ç»“è®º**: Phase 2.1 æˆåŠŸè¯†åˆ«äº†å…³é”®é—®é¢˜ï¼ˆearly stopping + è¯¾ç¨‹å­¦ä¹ ç­–ç•¥ï¼‰ï¼Œä½†æ€§èƒ½æœªè¾¾é¢„æœŸã€‚å»ºè®®ç«‹å³è¿›å…¥ Phase 2.2 ä¿®å¤è®­ç»ƒç­–ç•¥ã€‚
